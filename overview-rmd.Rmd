---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(tidyr)
library(tidyverse)
library(dplyr)
library(xlsx)
```

## Data cleaning

```{r cars}
path = "data/2017"
temp <- list.files(path=path)
data1 <- read.xlsx(paste(path,temp[1], sep="/"), sheetName = "Student", startRow = 2)
data2 <- read_csv(paste(path,temp[2], sep="/"))
```

```{r}
tag <- data2 %>% 
  select(`ID`, `UoA ID`, `UoA UPI`, `Tags`)
head(tag)
```

```{r}
partProg <- tag$Tags %>% 
  strsplit(., ",") %>% 
  setNames(tag$`UoA ID`) %>% 
  melt(value.name = "programme")

colnames(partProg) <- c("programme", "ID")

head(partProg,100)
```

```{r}
partInfo<- data1 %>% 
  select(`ID`, `Acad.Prog`, `Status`, `Descriptio`, `Acad.Plan`, `Plan.Description`, `Owner.of.Major.Spec.Module`)

head(partInfo,100)
```

```{r}
df <- merge(x=partProg, y=partInfo, by="ID", all.x = TRUE)
head(df,100)
```


```{r}
df_stud <- df %>% 
  filter(!is.na(Acad.Prog))

head(df_stud)
```

```{r}
df_stud %>% 
  ggplot() +
  geom_bar(aes(`Owner.of.Major.Spec.Module`), stat="count") +
  coord_flip() +
  theme_minimal()
```

